
# Терраформ создаёт inventory файл для ansible для настройки web_node
resource "local_file" "inventory_web_node" {
  content = <<-DOC
# Ansible inventory containing variable values from Terraform.
# Generated by Terraform.
[nodes:children]
web_nodes
[web_nodes]

#web_node ansible_host=${aws_instance.diplom-vm-web_node.private_ip} ansible_ssh_private_key_file=~/.ssh/${aws_key_pair.kp.key_name}.pem ansible_ssh_common_args='-o StrictHostKeyChecking=no'
#rproxy   ansible_host=${aws_instance.diplom-vm-rproxy.public_ip} ansible_ssh_private_key_file=~/.ssh/${aws_key_pair.kp.key_name}.pem ansible_ssh_common_args='-o StrictHostKeyChecking=no'

web_node ansible_host=${aws_instance.diplom-vm-rproxy.public_ip} ansible_ssh_private_key_file=~/.ssh/${aws_key_pair.kp.key_name}.pem ansible_ssh_common_args='-o StrictHostKeyChecking=no '

    DOC
  filename = "../ansible/web_node/inventory_web_node"

  depends_on = [
    aws_instance.diplom-vm-web_node
  ]
}
