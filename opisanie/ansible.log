ansible-playbook -i inventory/inventory_full provisioning.yaml -u ubuntu

PLAY [all] ***************************************************************************************************************************************************************************************************

TASK [common : Reading config] *******************************************************************************************************************************************************************************
ok: [rproxy]
ok: [web_node]
ok: [db01]
ok: [db02]
ok: [gitlab_node]
ok: [gitlabrunner_node]
ok: [monitoring_node]

TASK [common : Update repos] *********************************************************************************************************************************************************************************
changed: [rproxy]
changed: [gitlab_node]
changed: [web_node]
changed: [db02]
changed: [db01]
changed: [gitlabrunner_node]
changed: [monitoring_node]

TASK [common : Set timezone to Europe/Moscow] ****************************************************************************************************************************************************************
changed: [rproxy]
changed: [gitlab_node]
changed: [web_node]
changed: [db01]
changed: [db02]
changed: [gitlabrunner_node]
changed: [monitoring_node]

TASK [common : Copy file hosts] ******************************************************************************************************************************************************************************
changed: [rproxy]
changed: [web_node]
changed: [db02]
changed: [db01]
changed: [gitlab_node]
changed: [gitlabrunner_node]
changed: [monitoring_node]

TASK [common : install prometheus-node-exporter] *************************************************************************************************************************************************************
changed: [gitlab_node]
changed: [db02]
changed: [rproxy]
changed: [web_node]
changed: [db01]
changed: [gitlabrunner_node]
changed: [monitoring_node]

PLAY [web_node] **********************************************************************************************************************************************************************************************

TASK [Set a hostname to web_server] **************************************************************************************************************************************************************************
changed: [web_node]

PLAY [rproxy] ************************************************************************************************************************************************************************************************

TASK [Set a hostname to rproxy] ******************************************************************************************************************************************************************************
changed: [rproxy]

PLAY [db01] **************************************************************************************************************************************************************************************************

TASK [Set a hostname to db01] ********************************************************************************************************************************************************************************
changed: [db01]

PLAY [db02] **************************************************************************************************************************************************************************************************

TASK [Set a hostname to db02] ********************************************************************************************************************************************************************************
changed: [db02]

PLAY [gitlab_node] *******************************************************************************************************************************************************************************************

TASK [Set a hostname to gitlab] ******************************************************************************************************************************************************************************
changed: [gitlab_node]

PLAY [gitlabrunner_node] *************************************************************************************************************************************************************************************

TASK [Set a hostname to gitlabrunner] ************************************************************************************************************************************************************************
changed: [gitlabrunner_node]

PLAY [monitoring_node] ***************************************************************************************************************************************************************************************

TASK [Set a hostname to monitoring] **************************************************************************************************************************************************************************
changed: [monitoring_node]

PLAY [rproxy] ************************************************************************************************************************************************************************************************

TASK [rproxy : Reading variables] ****************************************************************************************************************************************************************************
ok: [rproxy]

TASK [rproxy : Install packages] *****************************************************************************************************************************************************************************
changed: [rproxy]

TASK [rproxy : install LetsEncript client acme.sh] ***********************************************************************************************************************************************************
[WARNING]: Consider using the get_url or uri module rather than running 'wget'.  If you need to use command because get_url or uri is insufficient you can add 'warn: false' to this command task or set
'command_warnings=False' in ansible.cfg to get rid of this message.
changed: [rproxy]

TASK [rproxy : Get Certificate] ******************************************************************************************************************************************************************************
changed: [rproxy]

TASK [rproxy : Creates directory] ****************************************************************************************************************************************************************************
changed: [rproxy]

TASK [rproxy : install Certificate] **************************************************************************************************************************************************************************
changed: [rproxy]

TASK [rproxy : Copy config for Nginx] ************************************************************************************************************************************************************************
changed: [rproxy]

TASK [rproxy : Restart Nginx] ********************************************************************************************************************************************************************************
changed: [rproxy]

PLAY [web_node] **********************************************************************************************************************************************************************************************

TASK [webserver : Reading config] ****************************************************************************************************************************************************************************
ok: [web_node]

TASK [webserver : Install Apache and php neededs] ************************************************************************************************************************************************************
changed: [web_node]

TASK [webserver : Download and Extract WorPress] *************************************************************************************************************************************************************
changed: [web_node]

TASK [webserver : Update default Apache site] ****************************************************************************************************************************************************************
changed: [web_node]

TASK [webserver : Rename sample config file to config] *******************************************************************************************************************************************************
changed: [web_node]

TASK [webserver : Insert parameters to Wordpress config file] ************************************************************************************************************************************************
changed: [web_node] => (item={'regexp': "define\\( 'DB_HOST', '(.)+' \\);", 'line': "define( 'DB_HOST', 'db01.citytours.ge' );"})
changed: [web_node] => (item={'regexp': "define\\( 'DB_NAME', '(.)+' \\);", 'line': "define( 'DB_NAME', 'wordpress' );"})
changed: [web_node] => (item={'regexp': "define\\( 'DB_USER', '(.)+' \\);", 'line': "define( 'DB_USER', 'wordpress' );"})
changed: [web_node] => (item={'regexp': "define\\( 'DB_PASSWORD', '(.)+' \\);", 'line': "define( 'DB_PASSWORD', 'wordpress' );"})

TASK [webserver : Update ownership to Apache user and Ubuntu] ************************************************************************************************************************************************
changed: [web_node]

TASK [webserver : Set the correct permissions on Wordpress directories] **************************************************************************************************************************************
changed: [web_node]

TASK [webserver : Restart Apache] ****************************************************************************************************************************************************************************
changed: [web_node]

PLAY [db01] **************************************************************************************************************************************************************************************************

TASK [mysql-cluster-management : Reading config] *************************************************************************************************************************************************************
ok: [db01]

TASK [mysql-cluster-management : change the directory] *******************************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-management : Download package] ***********************************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-management : install package] ************************************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-management : create directory] ***********************************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-management : Copy config] ****************************************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-management : copy ndb_mgmd.service file] *************************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-management : reload daemon] **************************************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-management : Initialize ndb_mgmd] ********************************************************************************************************************************************************
changed: [db01]

PLAY [db_nodes] **********************************************************************************************************************************************************************************************

TASK [mysql-cluster-datanode : Reading config] ***************************************************************************************************************************************************************
ok: [db01]
ok: [db02]

TASK [mysql-cluster-datanode : change the directory] *********************************************************************************************************************************************************
changed: [db01]
changed: [db02]

TASK [mysql-cluster-datanode : Download data-node package] ***************************************************************************************************************************************************
changed: [db01]
changed: [db02]

TASK [mysql-cluster-datanode : install libclass-methodmaker-perl] ********************************************************************************************************************************************
changed: [db02]
changed: [db01]

TASK [mysql-cluster-datanode : install data-node package] ****************************************************************************************************************************************************
changed: [db02]
changed: [db01]

TASK [mysql-cluster-datanode : copy my.cnf file] *************************************************************************************************************************************************************
changed: [db02]
changed: [db01]

TASK [mysql-cluster-datanode : Creates /usr/local/mysql/data directory] **************************************************************************************************************************************
changed: [db02]
changed: [db01]

TASK [mysql-cluster-datanode : Install ndbd.service file] ****************************************************************************************************************************************************
changed: [db02]
changed: [db01]

TASK [mysql-cluster-datanode : reload daemon] ****************************************************************************************************************************************************************
changed: [db02]
changed: [db01]

TASK [mysql-cluster-datanode : Initialize ndbd] **************************************************************************************************************************************************************
changed: [db01]
changed: [db02]

PLAY [db01] **************************************************************************************************************************************************************************************************

TASK [mysql-cluster-sqlnode : Reading config] ****************************************************************************************************************************************************************
ok: [db01]

TASK [mysql-cluster-sqlnode : Install dependencies] **********************************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : Download mysql common pack] ****************************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : install mysql common pack] *****************************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : Download mysql cluster community client plugin pack] ***************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : install cluster community clinet plugin pack] **********************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : Download mysql cluster community client core pack] *****************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : install cluster community clinet core pack] ************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : Download mysql cluster community client pack] **********************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : install cluster community clinet pack] *****************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : Download mysql client pack] ****************************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : install mysql  clinet pack] ****************************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : Download mysql cluster community server core pack] *****************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : install cluster community server core pack] ************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : Download mysql cluster community server pack] **********************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : Make answer for root password for installing mysql-community-server] ***********************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : Make answer for retype root password for installing mysql-community-server] ****************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : Make answer for Authentication Methodfor installing mysql-community-server] ****************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : install cluster community server package] **************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : Create mysql group] ************************************************************************************************************************************************************
ok: [db01]

TASK [mysql-cluster-sqlnode : Create myslq user] *************************************************************************************************************************************************************
ok: [db01]

TASK [mysql-cluster-sqlnode : Install config] ****************************************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : Activate init script and start mysql server] ***********************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : Create a new database called wordpress] ****************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : Configure new MySQL user wordpress for Wordpress connect to BD form any host] **************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : Test of Cluster] ***************************************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : Print Status of Cluster] *******************************************************************************************************************************************************
ok: [db01] => {
    "msg": [
        "Connected to Management Server at: db01.citytours.ge:1186",
        "Cluster Configuration",
        "---------------------",
        "[ndbd(NDB)]\t2 node(s)",
        "id=2\t@192.168.1.4  (mysql-8.0.30 ndb-8.0.30, Nodegroup: 0, *)",
        "id=3\t@192.168.1.5  (mysql-8.0.30 ndb-8.0.30, Nodegroup: 0)",
        "",
        "[ndb_mgmd(MGM)]\t1 node(s)",
        "id=1\t@192.168.1.4  (mysql-8.0.30 ndb-8.0.30)",
        "",
        "[mysqld(API)]\t1 node(s)",
        "id=4\t@192.168.1.4  (mysql-8.0.30 ndb-8.0.30)"
    ]
}

TASK [mysql-cluster-sqlnode : Test of Cluster] ***************************************************************************************************************************************************************
changed: [db01]

TASK [mysql-cluster-sqlnode : Print Status of NDB] ***********************************************************************************************************************************************************
ok: [db01] => {
    "msg": [
        "*************************** 1. row ***************************",
        "  Type: ndbclus",
        "  Name: connection",
        "Status: cluster_node_id=4, connected_host=db01.citytours.ge, connected_port=1186, number_of_data_nodes=2, number_of_ready_data_nodes=2, connect_count=0",
        "*************************** 2. row ***************************",
        "  Type: ndbclus",
        "  Name: NdbTransaction",
        "Status: created=2, free=2, sizeof=392",
        "*************************** 3. row ***************************",
        "  Type: ndbclus",
        "  Name: NdbOperation",
        "Status: created=4, free=4, sizeof=944",
        "*************************** 4. row ***************************",
        "  Type: ndbclus",
        "  Name: NdbIndexScanOperation",
        "Status: created=0, free=0, sizeof=1152",
        "*************************** 5. row ***************************",
        "  Type: ndbclus",
        "  Name: NdbIndexOperation",
        "Status: created=0, free=0, sizeof=952",
        "*************************** 6. row ***************************",
        "  Type: ndbclus",
        "  Name: NdbRecAttr",
        "Status: created=0, free=0, sizeof=88",
        "*************************** 7. row ***************************",
        "  Type: ndbclus",
        "  Name: NdbApiSignal",
        "Status: created=16, free=16, sizeof=144",
        "*************************** 8. row ***************************",
        "  Type: ndbclus",
        "  Name: NdbLabel",
        "Status: created=0, free=0, sizeof=200",
        "*************************** 9. row ***************************",
        "  Type: ndbclus",
        "  Name: NdbBranch",
        "Status: created=0, free=0, sizeof=32",
        "*************************** 10. row ***************************",
        "  Type: ndbclus",
        "  Name: NdbSubroutine",
        "Status: created=0, free=0, sizeof=72",
        "*************************** 11. row ***************************",
        "  Type: ndbclus",
        "  Name: NdbCall",
        "Status: created=0, free=0, sizeof=24",
        "*************************** 12. row ***************************",
        "  Type: ndbclus",
        "  Name: NdbBlob",
        "Status: created=0, free=0, sizeof=592",
        "*************************** 13. row ***************************",
        "  Type: ndbclus",
        "  Name: NdbReceiver",
        "Status: created=0, free=0, sizeof=128",
        "*************************** 14. row ***************************",
        "  Type: ndbclus",
        "  Name: NdbLockHandle",
        "Status: created=0, free=0, sizeof=48",
        "*************************** 15. row ***************************",
        "  Type: ndbclus",
        "  Name: binlog",
        "Status: latest_epoch=459561500688, latest_trans_epoch=420906795023, latest_received_binlog_epoch=0, latest_handled_binlog_epoch=420906795023, latest_applied_binlog_epoch=0"
    ]
}

PLAY [gitlab_node] *******************************************************************************************************************************************************************************************

TASK [gitlab : Reading config] *******************************************************************************************************************************************************************************
ok: [gitlab_node]

TASK [gitlab : Download gitlab install script] ***************************************************************************************************************************************************************
changed: [gitlab_node]

TASK [gitlab : Change script file ownership, group and permissions] ******************************************************************************************************************************************
changed: [gitlab_node]

TASK [gitlab : Run gitlab install script] ********************************************************************************************************************************************************************
changed: [gitlab_node]

TASK [gitlab : Install gitlab] *******************************************************************************************************************************************************************************
changed: [gitlab_node]

TASK [gitlab : install some needed python packages] **********************************************************************************************************************************************************
changed: [gitlab_node]

TASK [gitlab : install python-gitlab] ************************************************************************************************************************************************************************
changed: [gitlab_node]

TASK [gitlab : Set token for user root] **********************************************************************************************************************************************************************
changed: [gitlab_node]

TASK [gitlab : Create GitLab Project] ************************************************************************************************************************************************************************
changed: [gitlab_node]

PLAY [gitlabrunner_node] *************************************************************************************************************************************************************************************

TASK [gitlabrunner : Reading config] *************************************************************************************************************************************************************************
ok: [gitlabrunner_node]

TASK [gitlabrunner : remove other versions of docker] ********************************************************************************************************************************************************
ok: [gitlabrunner_node]

TASK [gitlabrunner : install repo key for docker for debian] *************************************************************************************************************************************************
changed: [gitlabrunner_node]

TASK [gitlabrunner : Add Docker Repository] ******************************************************************************************************************************************************************
changed: [gitlabrunner_node]

TASK [gitlabrunner : install docker] *************************************************************************************************************************************************************************
changed: [gitlabrunner_node]

TASK [gitlabrunner : Download gitlab runner package] *********************************************************************************************************************************************************
changed: [gitlabrunner_node]

TASK [gitlabrunner : Install gitlab runner] ******************************************************************************************************************************************************************
changed: [gitlabrunner_node]

TASK [gitlabrunner : Copy ssh-key to gitlabrunner] ***********************************************************************************************************************************************************
changed: [gitlabrunner_node]

TASK [gitlabrunner : Register gitlab runner to Gitlab server] ************************************************************************************************************************************************
changed: [gitlabrunner_node]

PLAY [monitoring_nodes] **************************************************************************************************************************************************************************************

TASK [monitoring : Reading config] ***************************************************************************************************************************************************************************
ok: [monitoring_node]

TASK [monitoring : Install dependency packages] **************************************************************************************************************************************************************
changed: [monitoring_node]

TASK [monitoring : Add Grafana repo key] *********************************************************************************************************************************************************************
changed: [monitoring_node]

TASK [monitoring : Add Grafana repo] *************************************************************************************************************************************************************************
changed: [monitoring_node]

TASK [monitoring : Update repositories cache and install grafana  package] ***********************************************************************************************************************************
changed: [monitoring_node]

TASK [monitoring : Configure Grafana user] *******************************************************************************************************************************************************************
changed: [monitoring_node]

TASK [monitoring : Make and Copy Config for Grafana] *********************************************************************************************************************************************************
changed: [monitoring_node]

TASK [monitoring : Configure Grafana Dashboard] **************************************************************************************************************************************************************
changed: [monitoring_node]

TASK [monitoring : Configure Grafana Datasources for Dashboard] **********************************************************************************************************************************************
changed: [monitoring_node]

TASK [monitoring : Install Prometheus and Alert-manager] *****************************************************************************************************************************************************
changed: [monitoring_node]

TASK [monitoring : Copy config for Prometheus] ***************************************************************************************************************************************************************
changed: [monitoring_node]

TASK [monitoring : Copy config] ******************************************************************************************************************************************************************************
changed: [monitoring_node]

TASK [monitoring : Copy rules for Alert] *********************************************************************************************************************************************************************
changed: [monitoring_node]

TASK [monitoring : Start monitoring services] ****************************************************************************************************************************************************************
changed: [monitoring_node] => (item=prometheus)
changed: [monitoring_node] => (item=grafana-server)
changed: [monitoring_node] => (item=prometheus-alertmanager)

PLAY RECAP ***************************************************************************************************************************************************************************************************
db01                       : ok=54   changed=46   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
db02                       : ok=16   changed=14   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
gitlab_node                : ok=15   changed=13   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
gitlabrunner_node          : ok=15   changed=12   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
monitoring_node            : ok=20   changed=18   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
rproxy                     : ok=14   changed=12   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
web_node                   : ok=15   changed=13   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
